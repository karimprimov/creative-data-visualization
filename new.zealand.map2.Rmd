---
title: "new.zealand.map2"
output: html_document
---

Websites:
Data: https://www.kaggle.com/datasets/kkhandekar/stolen-vehicle-dataset?resource=download
Mapping Plots: https://geocompr.robinlovelace.net/adv-map.html

```{r}
library(tidyverse)
library(manipulate)
library(patchwork)
library(infer)
library(broom)
library(sf)
library(raster)
library(dplyr)
library(spData)
library(spDataLarge)
library(tmap)    # for static and interactive maps
library(leaflet) # for interactive maps
library(ggplot2) # tidyverse data visualization package
```

```{r}
f <- "//Users/karimprimov/Desktop/UT Austin/Applied Data Analysis/creative-data-visualization/stolenvehicles.csv"
d <- read_csv(f, col_names = TRUE)
d <- as.data.frame(d)
```


```{r}
# Add fill layer to nz shape
tm_shape(nz) +
  tm_fill() 
# Add border layer to nz shape
tm_shape(nz) +
  tm_borders() 
# Add fill and border layers to nz shape
tm_shape(nz) +
  tm_fill() +
  tm_borders() 
```

```{r}
map_nz = tm_shape(nz) + tm_polygons()
class(map_nz)
```

```{r}
map_nz$tm_shape$shp$Name
```

Renaming "Auckland City" in "d" dataframe to "Auckland"
```{r}
d$Location[which(d$Location=="Auckland City")] <- "Auckland"
```

```{r}
unique(d$VehicleType)
```


```{r}
unique(d$Location)
```

Notes: 
```{r}
sort(map_nz$tm_shape$shp$Name)
```

Comparing sites in one dataset to sites in another dataset
```{r}
cbind(c(sort(unique(d$Location)[which(unique(d$Location) %in% map_nz$tm_shape$shp$Name)]),
        unique(d$Location)[-which(unique(d$Location) %in% map_nz$tm_shape$shp$Name)],
        rep("",4)), 
      c(sort(map_nz$tm_shape$shp$Name)[which(sort(map_nz$tm_shape$shp$Name) %in% unique(d$Location))],
        sort(map_nz$tm_shape$shp$Name)[-which(sort(map_nz$tm_shape$shp$Name) %in% unique(d$Location))]))
```

```{r}
map_nz$tm_shape$shp
```

Filter out the data for locations which is not found in both datasets
(for loop counting number of locations in Location column and in Name 
column of map_nz$tm_shape$shp dataframe), then count number of thefts 
in each location, then store each of those into a vector, then 
```{r}
d2 <- d %>%
  filter(Location %in% map_nz$tm_shape$shp$Name)
```


```{r}
unique(d2$Location)
```

```{r}
a <- rle(sort(d2$Location))
a
```

```{r}
a.df <- data.frame(values = a$values, lengths = a$lengths)
names(a.df)[1] <- "Name"
names(a.df)[2] <- "Thefts"
a.df
```

```{r}
dfmap_nz <- full_join(a.df, map_nz$tm_shape$shp, by = "Name")
dfmap_nz
```

```{r}
map_nz$tm_shape$shp$Thefts <- a.df$Thefts
```

```{r}

```


```{r}
#d$VehicleType <- as.factor(d$VehicleType)
```

```{r}
#d$VehicleModel <- as.factor(d$VehicleModel)
```

```{r}
#d$Location <- as.factor(d$Location)
```



# map_nz1 = map_nz +
#   tm_shape(nz_elev) + tm_raster(alpha = 0.7)
# 
# nz_water = st_union(nz) %>% st_buffer(22200) %>% 
#   st_cast(to = "LINESTRING")
# map_nz2 = map_nz1 +
#   tm_shape(nz_water) + tm_lines()
# 
# map_nz3 = map_nz2 +
#   tm_shape(nz_height) + tm_dots()
# 
# tmap_arrange(map_nz1, map_nz2, map_nz3)
# 
# 
# ma1 = tm_shape(nz) + tm_fill(col = "red")
# ma2 = tm_shape(nz) + tm_fill(col = "red", alpha = 0.3)
# ma3 = tm_shape(nz) + tm_borders(col = "blue")
# ma4 = tm_shape(nz) + tm_borders(lwd = 3)
# ma5 = tm_shape(nz) + tm_borders(lty = 2)
# ma6 = tm_shape(nz) + tm_fill(col = "red", alpha = 0.3) +
#   tm_borders(col = "blue", lwd = 3, lty = 2)
# tmap_arrange(ma1, ma2, ma3, ma4, ma5, ma6)
# 
# plot(st_geometry(nz), col = nz$Land_area)  # works
# tm_shape(nz) + tm_fill(col = nz$Land_area) # fails
# #> Error: Fill argument neither colors nor valid variable name(s)
# 
# tm_shape(nz) + tm_fill(col = "Land_area")
# 
# 
# legend_title = expression("Area (km"^2*")")
# map_nza = tm_shape(nz) +
#   tm_fill(col = "Land_area", title = legend_title) + tm_borders()
# 
# tm_shape(nz) + tm_polygons(col = "Median_income")
# breaks = c(0, 3, 4, 5) * 10000
# tm_shape(nz) + tm_polygons(col = "Median_income", breaks = breaks)
# tm_shape(nz) + tm_polygons(col = "Median_income", n = 10)
# tm_shape(nz) + tm_polygons(col = "Median_income", palette = "BuGn")
# 
# 
# tm_shape(nz) + tm_polygons("Population", palette = "Blues")
# tm_shape(nz) + tm_polygons("Population", palette = "YlOrBr")
 